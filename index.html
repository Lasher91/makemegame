<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GAMEGEN ‚Äî AI Game Generator</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
<style>
  :root {
    --black: #0a0a0a;
    --white: #f0ede6;
    --yellow: #FFE500;
    --red: #FF2D2D;
    --gray: #1a1a1a;
    --mid: #2a2a2a;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--black);
    color: var(--white);
    font-family: 'Space Mono', monospace;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* NOISE OVERLAY */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 9999;
    opacity: 0.4;
  }

  /* HEADER */
  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 24px 40px;
    border-bottom: 1px solid #222;
    position: relative;
  }

  .logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2.4rem;
    letter-spacing: 4px;
    color: var(--yellow);
    text-shadow: 3px 3px 0px var(--red);
  }

  .logo span { color: var(--white); }

  .tagline {
    font-size: 0.65rem;
    letter-spacing: 3px;
    color: #555;
    text-transform: uppercase;
  }

  .credits-badge {
    background: var(--gray);
    border: 1px solid #333;
    padding: 8px 16px;
    font-size: 0.7rem;
    letter-spacing: 2px;
    color: var(--yellow);
  }

  /* HERO */
  .hero {
    padding: 80px 40px 40px;
    max-width: 900px;
    margin: 0 auto;
    text-align: center;
  }

  .hero h1 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(3rem, 10vw, 7rem);
    line-height: 0.9;
    letter-spacing: 2px;
    margin-bottom: 24px;
  }

  .hero h1 .line1 { color: var(--white); display: block; }
  .hero h1 .line2 { color: var(--yellow); display: block; }
  .hero h1 .line3 { color: var(--red); display: block; font-size: 0.5em; letter-spacing: 8px; }

  .hero p {
    color: #666;
    font-size: 0.8rem;
    letter-spacing: 2px;
    margin-bottom: 48px;
    line-height: 1.8;
  }

  /* INPUT AREA */
  .input-section {
    max-width: 800px;
    margin: 0 auto;
    padding: 0 40px 60px;
  }

  .input-wrapper {
    position: relative;
    margin-bottom: 16px;
  }

  .game-input {
    width: 100%;
    background: var(--gray);
    border: 2px solid #333;
    color: var(--white);
    font-family: 'Space Mono', monospace;
    font-size: 1rem;
    padding: 24px 160px 24px 24px;
    resize: none;
    outline: none;
    min-height: 120px;
    transition: border-color 0.2s;
    line-height: 1.6;
  }

  .game-input::placeholder { color: #444; }
  .game-input:focus { border-color: var(--yellow); }

  .generate-btn {
    position: absolute;
    bottom: 16px;
    right: 16px;
    background: var(--yellow);
    color: var(--black);
    border: none;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.2rem;
    letter-spacing: 3px;
    padding: 12px 24px;
    cursor: pointer;
    transition: all 0.15s;
  }

  .generate-btn:hover {
    background: var(--white);
    transform: translate(-2px, -2px);
    box-shadow: 4px 4px 0 var(--yellow);
  }

  .generate-btn:active { transform: translate(0, 0); box-shadow: none; }
  .generate-btn:disabled { background: #333; color: #666; cursor: not-allowed; transform: none; box-shadow: none; }

  .examples {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-top: 12px;
  }

  .example-chip {
    background: transparent;
    border: 1px solid #333;
    color: #555;
    font-family: 'Space Mono', monospace;
    font-size: 0.65rem;
    padding: 6px 12px;
    cursor: pointer;
    letter-spacing: 1px;
    transition: all 0.15s;
  }

  .example-chip:hover { border-color: var(--yellow); color: var(--yellow); }

  /* STATUS */
  .status-bar {
    max-width: 800px;
    margin: 0 auto 24px;
    padding: 0 40px;
    display: none;
  }

  .status-bar.visible { display: block; }

  .status-inner {
    background: var(--gray);
    border-left: 3px solid var(--yellow);
    padding: 16px 20px;
    font-size: 0.75rem;
    letter-spacing: 2px;
    color: var(--yellow);
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .spinner {
    width: 16px;
    height: 16px;
    border: 2px solid #333;
    border-top-color: var(--yellow);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    flex-shrink: 0;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  /* GAME AREA */
  .game-section {
    max-width: 900px;
    margin: 0 auto;
    padding: 0 40px 80px;
    display: none;
  }

  .game-section.visible { display: block; }

  .game-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    padding-bottom: 16px;
    border-bottom: 1px solid #222;
  }

  .game-title-display {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.8rem;
    letter-spacing: 3px;
    color: var(--yellow);
  }

  .game-meta { font-size: 0.65rem; color: #444; letter-spacing: 2px; }

  .new-game-btn {
    background: transparent;
    border: 1px solid #444;
    color: #666;
    font-family: 'Space Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 2px;
    padding: 8px 16px;
    cursor: pointer;
    transition: all 0.15s;
  }

  .new-game-btn:hover { border-color: var(--red); color: var(--red); }

  /* GAME FRAME */
  #game-frame {
    width: 100%;
    min-height: 500px;
    border: 1px solid #222;
    background: #000;
    display: block;
  }

  /* ERROR */
  .error-box {
    background: #1a0a0a;
    border-left: 3px solid var(--red);
    padding: 20px;
    font-size: 0.75rem;
    color: var(--red);
    letter-spacing: 1px;
    line-height: 1.8;
    display: none;
  }

  .error-box.visible { display: block; }

  /* FOOTER */
  footer {
    border-top: 1px solid #1a1a1a;
    padding: 24px 40px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  footer p { font-size: 0.6rem; color: #333; letter-spacing: 2px; }

  /* DECORATIVE LINES */
  .deco-line {
    width: 100%;
    height: 1px;
    background: linear-gradient(90deg, transparent, #FFE500, transparent);
    opacity: 0.2;
    margin: 0;
  }

  /* API KEY MODAL */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 20px;
  }

  .modal-overlay.hidden { display: none; }

  .modal {
    background: var(--gray);
    border: 1px solid #333;
    padding: 48px;
    max-width: 560px;
    width: 100%;
  }

  .modal h2 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2.5rem;
    letter-spacing: 4px;
    color: var(--yellow);
    margin-bottom: 8px;
  }

  .modal p {
    font-size: 0.72rem;
    color: #666;
    letter-spacing: 1px;
    line-height: 1.8;
    margin-bottom: 32px;
  }

  .modal p a { color: var(--yellow); text-decoration: none; }

  .modal-input {
    width: 100%;
    background: var(--black);
    border: 1px solid #333;
    color: var(--white);
    font-family: 'Space Mono', monospace;
    font-size: 0.8rem;
    padding: 16px;
    outline: none;
    margin-bottom: 16px;
    letter-spacing: 1px;
  }

  .modal-input:focus { border-color: var(--yellow); }

  .modal-btn {
    width: 100%;
    background: var(--yellow);
    color: var(--black);
    border: none;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.3rem;
    letter-spacing: 4px;
    padding: 16px;
    cursor: pointer;
    transition: all 0.15s;
  }

  .modal-btn:hover { background: var(--white); }

  .modal-note {
    font-size: 0.6rem;
    color: #333;
    letter-spacing: 1px;
    margin-top: 16px;
    line-height: 1.8;
  }

  @media (max-width: 600px) {
    header { padding: 16px 20px; }
    .hero { padding: 40px 20px 20px; }
    .input-section, .game-section, .status-bar { padding-left: 20px; padding-right: 20px; }
    .modal { padding: 32px 24px; }
    .generate-btn { position: static; width: 100%; margin-top: 12px; }
    .game-input { padding: 20px; min-height: 100px; }
  }
</style>
</head>
<body>

<!-- API KEY MODAL -->
<div class="modal-overlay" id="api-modal">
  <div class="modal">
    <h2>SETUP</h2>
    <p>GAMEGEN uses the Claude API to generate your games in real time. Enter your Anthropic API key to get started. Your key is stored only in your browser and never sent anywhere except directly to Anthropic.<br><br>
    Get a free API key at <a href="https://console.anthropic.com" target="_blank">console.anthropic.com</a></p>
    <input type="password" class="modal-input" id="api-key-input" placeholder="sk-ant-api03-..." />
    <button class="modal-btn" onclick="saveApiKey()">START GENERATING</button>
    <p class="modal-note">‚ö° Your key is saved locally in your browser. You won't need to enter it again.</p>
  </div>
</div>

<!-- HEADER -->
<header>
  <div>
    <div class="logo">GAME<span>GEN</span></div>
    <div class="tagline">AI-Powered Game Generator</div>
  </div>
  <div class="credits-badge" id="credits-display">API READY</div>
</header>

<div class="deco-line"></div>

<!-- HERO -->
<div class="hero">
  <h1>
    <span class="line1">TYPE A GAME.</span>
    <span class="line2">PLAY IT NOW.</span>
    <span class="line3">‚Äî powered by AI ‚Äî</span>
  </h1>
  <p>DESCRIBE ANY GAME YOU WANT TO PLAY.<br>OUR AI BUILDS IT INSTANTLY IN YOUR BROWSER.</p>
</div>

<!-- INPUT -->
<div class="input-section">
  <div class="input-wrapper">
    <textarea 
      class="game-input" 
      id="game-prompt"
      placeholder="Describe your game... e.g. 'A space shooter where I defend Earth from giant tacos' or 'A trivia game about 90s music' or 'A maze game with a ninja'"
    ></textarea>
    <button class="generate-btn" id="gen-btn" onclick="generateGame()">GENERATE ‚ñ∂</button>
  </div>
  <div class="examples">
    <span class="example-chip" onclick="setExample(this)">üöÄ Space shooter with aliens</span>
    <span class="example-chip" onclick="setExample(this)">üß† 90s music trivia quiz</span>
    <span class="example-chip" onclick="setExample(this)">üêç Snake game with power-ups</span>
    <span class="example-chip" onclick="setExample(this)">üéØ Click the target game</span>
    <span class="example-chip" onclick="setExample(this)">üÉè Memory card matching game</span>
    <span class="example-chip" onclick="setExample(this)">üßÆ Math challenge speed game</span>
  </div>
</div>

<!-- STATUS -->
<div class="status-bar" id="status-bar">
  <div class="status-inner">
    <div class="spinner"></div>
    <span id="status-text">INITIALIZING AI ENGINE...</span>
  </div>
</div>

<!-- ERROR -->
<div class="input-section">
  <div class="error-box" id="error-box"></div>
</div>

<!-- GAME DISPLAY -->
<div class="game-section" id="game-section">
  <div class="game-header">
    <div>
      <div class="game-title-display" id="game-title-display">YOUR GAME</div>
      <div class="game-meta" id="game-meta">GENERATED BY AI</div>
    </div>
    <button class="new-game-btn" onclick="resetToInput()">‚Üê NEW GAME</button>
  </div>
  <iframe id="game-frame" sandbox="allow-scripts allow-same-origin" frameborder="0"></iframe>
</div>

<div class="deco-line"></div>

<footer>
  <p>¬© GAMEGEN ‚Äî AI GAME GENERATOR</p>
  <p style="cursor:pointer; color:#333;" onclick="clearApiKey()">RESET API KEY</p>
</footer>

<script>
  // ‚îÄ‚îÄ API KEY MANAGEMENT ‚îÄ‚îÄ
  function checkApiKey() {
    const key = localStorage.getItem('gamegen_api_key');
    if (key) {
      document.getElementById('api-modal').classList.add('hidden');
    }
  }

  function saveApiKey() {
    const key = document.getElementById('api-key-input').value.trim();
    if (!key.startsWith('sk-ant')) {
      alert('Please enter a valid Anthropic API key (starts with sk-ant)');
      return;
    }
    localStorage.setItem('gamegen_api_key', key);
    document.getElementById('api-modal').classList.add('hidden');
  }

  function clearApiKey() {
    if (confirm('Reset your API key?')) {
      localStorage.removeItem('gamegen_api_key');
      document.getElementById('api-modal').classList.remove('hidden');
    }
  }

  function getApiKey() {
    return localStorage.getItem('gamegen_api_key');
  }

  // ‚îÄ‚îÄ EXAMPLE CHIPS ‚îÄ‚îÄ
  function setExample(el) {
    const text = el.textContent.replace(/^[^\w]+/, '').trim();
    document.getElementById('game-prompt').value = text;
    document.getElementById('game-prompt').focus();
  }

  // ‚îÄ‚îÄ STATUS MESSAGES ‚îÄ‚îÄ
  const statusMessages = [
    'ANALYZING YOUR GAME CONCEPT...',
    'DESIGNING GAME MECHANICS...',
    'WRITING GAME LOGIC...',
    'BUILDING THE INTERFACE...',
    'ADDING ANIMATIONS...',
    'FINAL TOUCHES...',
    'ALMOST READY...'
  ];

  let statusInterval;

  function startStatusCycle() {
    let i = 0;
    document.getElementById('status-text').textContent = statusMessages[0];
    statusInterval = setInterval(() => {
      i = Math.min(i + 1, statusMessages.length - 1);
      document.getElementById('status-text').textContent = statusMessages[i];
    }, 2500);
  }

  function stopStatusCycle() {
    clearInterval(statusInterval);
  }

  // ‚îÄ‚îÄ GENERATE GAME ‚îÄ‚îÄ
  async function generateGame() {
    const prompt = document.getElementById('game-prompt').value.trim();
    if (!prompt) {
      document.getElementById('game-prompt').focus();
      return;
    }

    const apiKey = getApiKey();
    if (!apiKey) {
      document.getElementById('api-modal').classList.remove('hidden');
      return;
    }

    // UI state
    document.getElementById('gen-btn').disabled = true;
    document.getElementById('gen-btn').textContent = 'GENERATING...';
    document.getElementById('status-bar').classList.add('visible');
    document.getElementById('game-section').classList.remove('visible');
    document.getElementById('error-box').classList.remove('visible');
    startStatusCycle();

    const systemPrompt = `You are an expert game developer who creates complete, playable browser games using HTML, CSS, and JavaScript in a single file.

RULES:
1. Generate ONLY a complete, valid HTML file - nothing else, no explanation, no markdown
2. The game must be immediately playable - no setup required
3. Include ALL game logic, styles, and assets inline
4. Make the game visually appealing with a dark theme
5. Add a score system where appropriate
6. Add clear instructions within the game UI
7. The game must work in an iframe sandbox (allow-scripts)
8. Use canvas or DOM elements - no external libraries
9. Make it fun and polished
10. Add sound effects using the Web Audio API where appropriate
11. The game title should match what the user asked for

Create a genuinely fun, complete game. Be creative with the mechanics.`;

    const userMessage = `Create a complete playable browser game based on this description: "${prompt}"

The game should be creative, fun, and immediately playable. Include a score system, lives/health if appropriate, and a game over screen with restart option. Make it visually polished with animations.`;

    try {
      const response = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-api-key': apiKey,
          'anthropic-version': '2023-06-01',
          'anthropic-dangerous-direct-browser-access': 'true'
        },
        body: JSON.stringify({
          model: 'claude-sonnet-4-5-20250929',
          max_tokens: 8000,
          system: systemPrompt,
          messages: [{ role: 'user', content: userMessage }]
        })
      });

      if (!response.ok) {
        const err = await response.json();
        throw new Error(err.error?.message || `API Error: ${response.status}`);
      }

      const data = await response.json();
      const gameCode = data.content[0].text;

      // Extract HTML if wrapped in markdown
      let html = gameCode;
      const htmlMatch = gameCode.match(/```html\n?([\s\S]*?)```/);
      if (htmlMatch) html = htmlMatch[1];
      else if (gameCode.includes('<!DOCTYPE') || gameCode.includes('<html')) {
        const start = gameCode.indexOf('<!DOCTYPE') !== -1 
          ? gameCode.indexOf('<!DOCTYPE') 
          : gameCode.indexOf('<html');
        html = gameCode.substring(start);
      }

      // Display game
      stopStatusCycle();
      document.getElementById('status-bar').classList.remove('visible');

      // Set title
      const titleMatch = html.match(/<title>(.*?)<\/title>/i);
      const gameTitle = titleMatch ? titleMatch[1].toUpperCase() : prompt.toUpperCase().substring(0, 40);
      document.getElementById('game-title-display').textContent = gameTitle;
      document.getElementById('game-meta').textContent = `GENERATED ${new Date().toLocaleTimeString()} ‚Äî POWERED BY CLAUDE AI`;

      // Load into iframe
      const frame = document.getElementById('game-frame');
      frame.srcdoc = html;
      frame.style.minHeight = '560px';

      document.getElementById('game-section').classList.add('visible');

      // Scroll to game
      setTimeout(() => {
        document.getElementById('game-section').scrollIntoView({ behavior: 'smooth' });
      }, 200);

    } catch (err) {
      stopStatusCycle();
      document.getElementById('status-bar').classList.remove('visible');

      const errorBox = document.getElementById('error-box');
      errorBox.textContent = `ERROR: ${err.message}\n\nPlease check your API key and try again.`;
      errorBox.classList.add('visible');

      if (err.message.includes('401') || err.message.includes('authentication')) {
        localStorage.removeItem('gamegen_api_key');
        setTimeout(() => {
          document.getElementById('api-modal').classList.remove('hidden');
        }, 2000);
      }
    } finally {
      document.getElementById('gen-btn').disabled = false;
      document.getElementById('gen-btn').textContent = 'GENERATE ‚ñ∂';
    }
  }

  // ‚îÄ‚îÄ RESET ‚îÄ‚îÄ
  function resetToInput() {
    document.getElementById('game-section').classList.remove('visible');
    document.getElementById('game-prompt').value = '';
    document.getElementById('game-prompt').focus();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  // ‚îÄ‚îÄ KEYBOARD SHORTCUT ‚îÄ‚îÄ
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && e.ctrlKey) generateGame();
  });

  // ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
  checkApiKey();
</script>
</body>
</html>
